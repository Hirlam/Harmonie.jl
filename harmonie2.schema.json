{
  "$id" : " https://roelstappers.github.io/harmonie2.schema.json",
  "title": "Harmonie experiment configuration",
  "options": {
    "disable_properties": true,
    "disable_edit_json": true,
    "disable_collapse": true
  },
  "format": "categories",
  "basicCategoryTitle": "Main",
  "type": "object",
  "required": [
    "DTGBEG",
    "Geometry",
    "Nesting",
    "Assimilation",
    "Physics",
    "Observations"
  ],
  "properties": {
    "DTGBEG": {
      "type": "string",
      "format": "datetime-local",
      "title": "DTGBEG",
      "options": {
        "grid_columns": 4,
        "placeholder": "Enter datetime",
        "flatpickr": {
          "hourIncrement": 3,
          "time_24hr": true,
          "dateFormat": "YmdH",
          "defaultHour": 0
        }
      }
    },
    "DTGEND": {
      "type": "string",
      "format": "datetime-local",
      "title": "DTGEND",
      "options": {
        "grid_columns": 4,
        "placeholder": "Enter datetime",
        "flatpickr": {
          "hourIncrement": 3,
          "time_24hr": true,
          "dateFormat": "YmdH",
          "defaultHour": 0
        }
      }
    },
    "Geometry": {
      "$ref" : "geometry.schema.json"
    },
    "Nesting": {
      "type": "object",
      "options": {
        "disable_properties": true,
        "disable_edit_json": true,
        "disable_collapse": true,
        "collapsed": false
      },
      "required": [
        "HOST_MODEL",
        "HOST_SURFEX",
        "SURFEX_INPUT_FORMAT",
        "BDSTRATEGY",
        "BDINT"
      ],
      "properties": {
        "HOST_MODEL": {
          "type": "string",
          "enum": [
            "ifs",
            "hir",
            "ald",
            "ala",
            "aro"
          ],
          "default": "ifs"
        },
        "HOST_SURFEX": {
          "title": "host model has run with surfex?",
          "type": "string",
          "enum": [
            "yes",
            "no"
          ],
          "default": "no"
        },
        "SURFEX_INPUT_FORMAT": {
          "type": "string",
          "title": "Input format for host model run with surfex",
          "default": "lfi",
          "enum": [
            "fa",
            "lfi"
          ]
        },
        "BDSTRATEGY": {
          "type": "string",
          "enum": [
            "available",
            "simulate_operational",
            "same_forecast",
            "analysis_only",
            "e40",
            "era5",
            "latest",
            "RCR_operational"
          ],
          "default": "simulate_operational"
        },
        "BDINT": {
          "type": "integer",
          "description": "Boundary interval in hours",
          "enum": [
            1,
            2,
            3,
            6,
            12,
            24
          ],
          "default": 1
        }
      }
    },
    "Assimilation": {
      "type": "object",
      "options": {
        "disable_properties": true,
        "disable_edit_json": true,
        "disable_collapse": true
      },
      "required": [
        "LSMIXBC",
        "ANAATMO"
      ],
      "properties": {
        "ANAATMO": {
          "type": "string",
          "enum": [
            "3DVAR",
            "4DVAR",
            "blending",
            "none"
          ],
          "options": {
            "hidden": true
          }
        },
        "LSMIXBC": {
          "type": "string",
          "enum": [
            "yes",
            "no"
          ],
          "title": "Large scale mixing"
        }
      },
      "additionalProperties": false,
      "oneOf": [
        {
          "title": "3DVAR",
          "type": "object",
          "properties": {
            "ANAATMO": {
              "enum": [
                "3DVAR"
              ],
              "default": "3DVAR"
            },
            "LSMIXBC": {
              "enum": [
                "yes"
              ],
              "default": "yes"
            }
          }
        },
        {
          "title": "4DVAR",
          "type": "object",
          "required": [
            "NOUTERLOOP",
            "ILRES",
            "TSTEP4D"
          ],
          "properties": {
            "ANAATMO": {
              "type": "string",
              "enum": [
                "4DVAR"
              ],
              "default": "4DVAR",
              "options": {
                "hidden": "true"
              }
            },
            "NOUTERLOOP": {
              "type": "integer",
              "enum": [
                1,
                2,
                3
              ],
              "default": 2
            },
            "ILRES": {
              "type": "string",
              "default": "2,2"
            },
            "TSTEP4D": {
              "type": "string",
              "default": "120,120"
            },
            "LSMIXBC": {
              "default": "no"
            }
          }
        },
        {
          "title": "blending",
          "properties": {
            "ANAATMO": {
              "default": "blending"
            }
          }
        },
        {
          "title": "none",
          "properties": {
            "ANAATMO": {
              "default": "none"
            }
          }
        }
      ]
    },
    "Physics": {
      "type": "object",
      "options": {
        "disable_properties": true,
        "disable_edit_json": true,
        "disable_collapse": true
      },
      "oneOf": [
        {
          "title": "Arome",
          "type": "object",
          "required": [
            "PHYSICS",
            "MASS_FLUX_SCHEME",
            "HARATU"
          ],
          "properties": {
            "PHYSICS": {
              "type": "string",
              "enum": [
                "arome"
              ],
              "default": "arome",
              "options": {
                "hidden": "true"
              }
            },
            "HARATU": {
              "type": "boolean",
              "default": true
            },
            "MASS_FLUX_SCHEME": {
              "type": "string",
              "description": "edkf: AROME-MF version, edmfm: Eddy Diffusivity Mass Flux  Meso-scale (KNMI)",
              "enum": [
                "edkf",
                "edmfm"
              ],
              "options": {
                "enum_titles": [
                  "edkf : AROME-MF version",
                  "edmfm : Eddy Diffusivity Mass Flux Meso scale (KNMI)"
                ]
              },
              "default": "edmfm"
            }
          }
        },
        {
          "title": "Alaro",
          "type": "object",
          "required": [
            "ALARO_VERSION",
            "PHYSICS"
          ],
          "properties": {
            "PHYSICS": {
              "type": "string",
              "enum": [
                "alaro"
              ],
              "default": "alaro",
              "options": {
                "hidden": "true"
              }
            },
            "ALARO_VERSION": {
              "type": "integer",
              "enum": [
                0,
                1
              ],
              "default": 0
            }
          }
        }
      ]
    },
    "Observations": {
      "type": "object",
      "options": {
        "collapsed": false
      },
      "required": [
        "OBDIR",
        "SINGLEOBS",
        "USE_MSG",
        "MSG_PATH"
      ],
      "properties": {
        "OBDIR": {
          "type": "string",
          "default": "$HMDATA/observations"
        },
        "SINGLEOBS": {
          "type": "string",
          "enum": [
            "yes",
            "no"
          ],
          "default": "no"
        },
        "USE_MSG": {
          "type": "string",
          "enum": [
            "yes",
            "no"
          ],
          "default": "no"
        },
        "MSG_PATH": {
          "type": "string",
          "default": "$SCRATCH/CLOUDS"
        }
      }
    },
    "EPS": {
      "type": "object"
    },
    "EDA": {
      "type": "object"
    },
    "Postprocessing": {
      "type": "object"
    },
    "Archiving": {
      "type": "object"
    }
  }
}
